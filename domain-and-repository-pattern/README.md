# 领域模型和仓储模式 (Domain Model and Repository Pattern)

这个目录展示了领域驱动设计中的领域模型和仓储模式实现。通过一个简单的笔记应用，演示了如何使用领域模型封装业务规则和逻辑，以及如何使用仓储模式封装数据访问细节。

## 架构概述

该架构模式的核心组件包括：

1. **领域模型 (Domain Model)**：包含业务实体和业务规则，是系统的核心。
2. **仓储 (Repository)**：封装数据访问细节，提供对领域模型的持久化操作。
3. **服务层 (Service Layer)**：协调领域模型和仓储，实现业务用例。
4. **用户界面层 (UI Layer)**：处理用户交互，将领域模型转换为适合UI展示的数据结构。
5. **数据库访问 (Database Access)**：提供底层数据库操作。

## 目录结构

```
domain-and-repository-pattern/
├── src/              # 源代码
│   ├── model.py     # 领域模型
│   ├── repository.py # 仓储层
│   ├── service.py   # 服务层
│   ├── ui.py        # 用户界面层
│   ├── db.py        # 数据库访问
│   └── main.py      # 应用入口
```

## 组件详解

### 领域模型 (model.py)

领域模型是系统的核心，包含业务实体和业务规则。在本例中，`Note` 类代表笔记实体，它包含：

- 属性：id, content, created_time, updated_time
- 业务规则：内容不能为空，ID必须有效
- 业务操作：更新笔记内容

领域模型的特点是它不依赖于其他层，而是包含了业务逻辑和规则。

### 仓储 (repository.py)

仓储模式封装了数据访问细节，提供了对领域模型的持久化操作。`NoteRepository` 类提供了：

- 创建笔记
- 查询笔记
- 更新笔记
- 删除笔记

仓储层依赖于领域模型和数据库访问层，但不包含业务逻辑。

### 服务层 (service.py)

服务层协调领域模型和仓储，实现业务用例。`Service` 类提供了：

- 创建笔记：生成ID，创建Note对象，调用仓储保存
- 查询笔记：调用仓储查询，返回Note对象
- 更新笔记：查询Note对象，更新内容，调用仓储保存
- 删除笔记：调用仓储删除

服务层依赖于领域模型和仓储层，包含了业务用例的实现。

### 用户界面层 (ui.py)

用户界面层处理用户交互，将领域模型转换为适合UI展示的数据结构。`UI` 类提供了：

- 创建笔记：调用服务层，返回ID
- 查询笔记：调用服务层，将Note对象转换为字典
- 更新笔记：调用服务层，将Note对象转换为字典
- 删除笔记：调用服务层

UI层依赖于服务层，但不直接依赖于领域模型和仓储层。它使用Python内置类型（如字典）而非领域模型，实现关注点分离。

### 数据库访问 (db.py)

数据库访问层提供底层数据库操作。`DB` 类提供了：

- 创建表
- 执行SQL语句

数据库访问层不依赖于其他层，只提供基本的数据库操作。

## 设计考量

1. **关注点分离**：每一层都有明确的职责，不同层之间通过接口交互。
2. **领域模型封装业务规则**：业务规则集中在领域模型中，便于维护和扩展。
3. **仓储模式封装数据访问**：数据访问细节对上层透明，便于切换数据存储方式。
4. **UI层使用内置类型**：UI层不直接依赖领域模型，而是使用内置类型，实现关注点分离。

## 与分层架构的对比

相比于传统的分层架构，领域模型和仓储模式有以下特点：

1. **领域模型更加丰富**：不仅包含数据，还包含业务规则和逻辑。
2. **数据访问更加抽象**：通过仓储模式封装数据访问细节，而不是直接使用数据库操作。
3. **业务逻辑分布不同**：业务逻辑分布在领域模型和服务层，而不是集中在服务层。
4. **更加面向对象**：整体设计更加面向对象，而不是面向过程。

## 运行示例

```bash
cd domain-and-repository-pattern/src
python main.py
```

这将运行一个简单的笔记应用示例，展示创建、查询、更新和删除笔记的功能。
